{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block content %}
<div class="row mb-3">
  <div class="col">
    <h2>{{ problem.title }}</h2>
  </div>
  {% if user.is_staff or user == problem.author %}
    <div class="col-auto">
      <a href="{% url 'edit_problem' problem.id %}" class="btn btn-primary btn-lg btn-round">
	    <i class="fas fa-edit"></i><span class="d-none d-sm-inline icon-left">Edit Problem</span>
      </a>
    </div>
  {% endif %}
</div>

<div class="row">
  <div class="col-md-6">
    {% include 'problem_preview.html' with problem_text=problem.problem_text answer=problem.answer solution=problem.solution %}
  </div>
  <div class="col-md-6">
    <p class="text-secondary">Proposed by {{ problem.author }}</p>
    <p class="text-secondary">Subject: {{ problem.get_subject_display }}</p>
	<hr/>
	<p>Difficulty: {{ avg_difficulty }}</p>
	{% if user.is_staff %}
	  <p>Quality: {{ avg_quality }}</p>
	{% endif %}
	<button type="button" class="btn btn-info" data-toggle="modal" data-target="#ratingModal">Rate Problem</button>
	<hr/>
	<h4>Comments</h4>
	<p>No comments yet</p>
  </div>
</div>

<div class="modal fade" id="ratingModal" tabindex="-1" role="dialog" aria-labelledby="ratingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ratingModalLabel">Rate Problem</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
		<form method="post" id="ratingForm">
		  {% csrf_token %}
		  {% crispy rating_form %}
		</form>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary" form="ratingForm">Rate</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
