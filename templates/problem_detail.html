{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block content %}
<div class="row mb-3">
  <div class="col">
    <h2>{{ problem.title }}</h2>
  </div>
  {% if user.is_staff or user == problem.author %}
    <div class="col-auto">
      <a href="{% url 'edit_problem' problem.id %}" class="btn btn-primary btn-lg btn-round">
	    <i class="fas fa-edit"></i><span class="d-none d-sm-inline icon-left">Edit Problem</span>
      </a>
    </div>
  {% endif %}
</div>

<div class="row">
  <div class="col-md-6">
	<div class="card mb-4">
	  <div class="card-body">
		{{ problem.problem_text|linebreaks }}
		<p class="card-text text-muted text-right">Proposed by {{ problem.author }}</p>
	  </div>
	</div>

	<div class="accordion" id="accordionAnswer">
	  <div class="card mb-4">
		<div class="card-header">
			<a href="#collapseAnswer" class="stretched-link text-reset text-decoration-none collapsed" data-toggle="collapse">Answer</a>
		</div>
		<div id="collapseAnswer" class="collapse" data-parent="#accordionAnswer">
		  <div class="card-body">
			{{ problem.answer|linebreaks }}
		  </div>
		</div>
	  </div>
	</div>

	<div class="accordion" id="accordionSolution">
	  <div class="card mb-4">
		<div class="card-header">
			<a href="#collapseSolution" class="stretched-link text-reset text-decoration-none collapsed" data-toggle="collapse">Solution</a>
		</div>
		<div id="collapseSolution" class="collapse" data-parent="#accordionSolution">
		  <div class="card-body">
			{{ problem.solution|linebreaks }}
		  </div>
		</div>
	  </div>
	</div>
  </div>

  <div class="col-md-6">
    <p class="text-secondary">Subject: {{ problem.get_subject_display }}</p>
	<hr/>
	<p>Difficulty: {{ avg_difficulty }}</p>
	{% if user.is_staff %}
	  <p>Quality: {{ avg_quality }}</p>
	{% endif %}
	<button type="button" class="btn btn-info" data-toggle="modal" data-target="#ratingModal">Rate Problem</button>
	<hr/>
	<h4>Comments</h4>
	<p>No comments yet</p>
  </div>
</div>

<div class="row mb-4">
  <div class="col">
	<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteModal">Delete</button>
  </div>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Are you sure?</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Do you really want to delete this problem? This cannot be undone.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary mr-auto" data-dismiss="modal">Cancel</button>
		<form method="post">
		  {% csrf_token %}
          <button type="submit" class="btn btn-danger" name="submit" value="delete">Delete</button>
		</form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="ratingModal" tabindex="-1" role="dialog" aria-labelledby="ratingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ratingModalLabel">Rate Problem</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
		<form method="post" id="ratingForm">
		  {% csrf_token %}
		  {% crispy rating_form %}
		</form>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary" form="ratingForm" name="submit" value="rate">Rate</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
